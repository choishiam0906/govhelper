// KSIC (한국표준산업분류) 조회 소스
// industryCode를 업태/종목으로 변환
// 로컬 매핑 테이블 사용 (DB 조회 없음)

import type { KSICResult } from '../types'

// 중분류 → 대분류 매핑 테이블
const MAJOR_CATEGORY_MAP: Record<string, string> = {
  // A: 농업, 임업 및 어업
  '01': 'A', '02': 'A', '03': 'A',
  // B: 광업
  '05': 'B', '06': 'B', '07': 'B', '08': 'B',
  // C: 제조업
  '10': 'C', '11': 'C', '12': 'C', '13': 'C', '14': 'C', '15': 'C', '16': 'C', '17': 'C',
  '18': 'C', '19': 'C', '20': 'C', '21': 'C', '22': 'C', '23': 'C', '24': 'C', '25': 'C',
  '26': 'C', '27': 'C', '28': 'C', '29': 'C', '30': 'C', '31': 'C', '32': 'C', '33': 'C', '34': 'C',
  // D: 전기, 가스, 증기 및 공기 조절 공급업
  '35': 'D',
  // E: 수도, 하수 및 폐기물 처리, 원료 재생업
  '36': 'E', '37': 'E', '38': 'E', '39': 'E',
  // F: 건설업
  '41': 'F', '42': 'F',
  // G: 도매 및 소매업
  '45': 'G', '46': 'G', '47': 'G',
  // H: 운수 및 창고업
  '49': 'H', '50': 'H', '51': 'H', '52': 'H',
  // I: 숙박 및 음식점업
  '55': 'I', '56': 'I',
  // J: 정보통신업
  '58': 'J', '59': 'J', '60': 'J', '61': 'J', '62': 'J', '63': 'J',
  // K: 금융 및 보험업
  '64': 'K', '65': 'K', '66': 'K',
  // L: 부동산업
  '68': 'L',
  // M: 전문, 과학 및 기술 서비스업
  '70': 'M', '71': 'M', '72': 'M', '73': 'M',
  // N: 사업시설 관리, 사업 지원 및 임대 서비스업
  '74': 'N', '75': 'N', '76': 'N',
  // O: 공공 행정, 국방 및 사회보장 행정
  '84': 'O',
  // P: 교육 서비스업
  '85': 'P',
  // Q: 보건업 및 사회복지 서비스업
  '86': 'Q', '87': 'Q', '88': 'Q',
  // R: 예술, 스포츠 및 여가관련 서비스업
  '90': 'R', '91': 'R',
  // S: 협회 및 단체, 수리 및 기타 개인 서비스업
  '94': 'S', '95': 'S', '96': 'S',
  // T: 가구 내 고용활동 및 달리 분류되지 않은 자가 소비 생산활동
  '97': 'T', '98': 'T',
  // U: 국제 및 외국기관
  '99': 'U',
}

// 대분류 코드 → 업태명 매핑
const MAJOR_CATEGORY_NAMES: Record<string, string> = {
  'A': '농업, 임업 및 어업',
  'B': '광업',
  'C': '제조업',
  'D': '전기, 가스, 증기 및 공기 조절 공급업',
  'E': '수도, 하수 및 폐기물 처리, 원료 재생업',
  'F': '건설업',
  'G': '도매 및 소매업',
  'H': '운수 및 창고업',
  'I': '숙박 및 음식점업',
  'J': '정보통신업',
  'K': '금융 및 보험업',
  'L': '부동산업',
  'M': '전문, 과학 및 기술 서비스업',
  'N': '사업시설 관리, 사업 지원 및 임대 서비스업',
  'O': '공공 행정, 국방 및 사회보장 행정',
  'P': '교육 서비스업',
  'Q': '보건업 및 사회복지 서비스업',
  'R': '예술, 스포츠 및 여가관련 서비스업',
  'S': '협회 및 단체, 수리 및 기타 개인 서비스업',
  'T': '가구 내 고용활동 및 달리 분류되지 않은 자가 소비 생산활동',
  'U': '국제 및 외국기관',
}

// 주요 세세분류 코드 → 종목명 매핑 (자주 사용되는 업종)
const COMMON_INDUSTRY_NAMES: Record<string, string> = {
  // 정보통신업 (J)
  '58110': '서적 출판업',
  '58121': '신문 발행업',
  '58190': '기타 인쇄물 출판업',
  '58211': '게임 소프트웨어 개발 및 공급업',
  '58219': '기타 패키지 소프트웨어 개발 및 공급업',
  '58221': '시스템 소프트웨어 개발 및 공급업',
  '58222': '응용 소프트웨어 개발 및 공급업',
  '59111': '일반 영화 및 비디오물 제작업',
  '59120': '영화, 비디오물 및 방송프로그램 배급업',
  '59201': '음악 및 기타 오디오물 출판업',
  '61210': '유선 통신업',
  '61220': '무선 통신업',
  '61299': '그 외 기타 전기 통신업',
  '62010': '컴퓨터 프로그래밍 서비스업',
  '62021': '컴퓨터시스템 통합 자문 및 구축 서비스업',
  '62022': '컴퓨터시스템 관리 및 지원 서비스업',
  '62090': '기타 정보기술 및 컴퓨터운영 관련 서비스업',
  '63111': '자료 처리업',
  '63112': '호스팅 및 관련 서비스업',
  '63120': '포털 및 기타 인터넷 정보매개 서비스업',
  '63991': '데이터베이스 및 온라인정보 제공업',
  '63999': '그 외 기타 정보 서비스업',
  // 전문, 과학 및 기술 서비스업 (M)
  '70111': '경영 컨설팅업',
  '70112': '공공관계 컨설팅업',
  '70121': '엔지니어링 서비스업',
  '72111': '물리, 화학 및 생물학 연구개발업',
  '72112': '농학 연구개발업',
  '72119': '기타 자연과학 연구개발업',
  '72191': '전기ㆍ전자공학 연구개발업',
  '72192': '기계공학 연구개발업',
  '72199': '그 외 기타 공학 연구개발업',
  '73201': '시장조사 및 여론조사업',
  '73202': '광고 대행업',
  // 제조업 (C)
  '26110': '메모리용 전자집적회로 제조업',
  '26121': '발광 다이오드 제조업',
  '26129': '기타 비메모리용 및 혼성 집적회로 제조업',
  '26211': '액정 표시장치 제조업',
  '26221': '인쇄회로기판 제조업',
  '26310': '컴퓨터 제조업',
  '26410': '유선 통신장비 제조업',
  '26421': '방송장비 제조업',
  '26429': '기타 무선 통신장비 제조업',
  '26519': '기타 비디오 및 오디오 기기 제조업',
  // 도매 및 소매업 (G)
  '46331': '컴퓨터 및 주변장치 도매업',
  '46332': '소프트웨어 도매업',
  '47911': '전자상거래 소매 중개업',
  '47912': '전자상거래 소매업',
  '47913': '소비자 직접 판매업',
  // 건설업 (F)
  '41110': '주거용 건물 건설업',
  '41120': '비주거용 건물 건설업',
  '42110': '도로 건설업',
  '42201': '상ㆍ하수도 건설업',
  // 금융 및 보험업 (K)
  '64110': '중앙 은행',
  '64121': '시중 은행',
  '64191': '여신 전문 금융업',
  '65110': '생명 보험업',
  '65210': '손해 보험업',
  // 숙박 및 음식점업 (I)
  '55101': '호텔업',
  '55102': '휴양콘도 운영업',
  '56111': '한식 음식점업',
  '56112': '중식 음식점업',
  '56113': '일식 음식점업',
  '56114': '서양식 음식점업',
  '56190': '기타 음식점업',
  '56211': '제과점업',
  '56212': '피자ㆍ햄버거ㆍ샌드위치 및 유사 음식점업',
  '56213': '치킨 전문점',
  '56219': '기타 간이 음식점업',
  '56220': '주점업',
  // 교육 서비스업 (P)
  '85110': '초등 교육기관',
  '85121': '일반 중등 교육기관',
  '85130': '고등 교육기관',
  '85411': '일반 교과 학원',
  '85412': '외국어 학원',
  '85501': '스포츠 교육기관',
  // 보건업 및 사회복지 서비스업 (Q)
  '86101': '종합 병원',
  '86102': '일반 병원',
  '86201': '일반 의원',
  '86210': '치과 의원',
  '86221': '한의원',
}

// 중분류 코드 → 중분류명 매핑
const MIDDLE_CATEGORY_NAMES: Record<string, string> = {
  // 정보통신업
  '58': '출판업',
  '59': '영상ㆍ오디오 기록물 제작 및 배급업',
  '60': '방송업',
  '61': '우편 및 통신업',
  '62': '컴퓨터 프로그래밍, 시스템 통합 및 관리업',
  '63': '정보서비스업',
  // 제조업 주요
  '26': '전자부품, 컴퓨터, 영상, 음향 및 통신장비 제조업',
  '27': '의료, 정밀, 광학 기기 및 시계 제조업',
  '29': '기타 기계 및 장비 제조업',
  '30': '자동차 및 트레일러 제조업',
  // 도매 및 소매업
  '45': '자동차 및 부품 판매업',
  '46': '도매 및 상품 중개업',
  '47': '소매업',
}

/**
 * 산업코드로 KSIC 정보 조회 (로컬 매핑 사용)
 */
export async function lookupFromKSIC(
  industryCode: string | null
): Promise<KSICResult | null> {
  if (!industryCode || industryCode.trim() === '') {
    return null
  }

  const code = industryCode.trim()

  // 대분류 코드 계산
  const middleCode = code.substring(0, 2)
  const majorCode = MAJOR_CATEGORY_MAP[middleCode]
  const businessType = majorCode ? MAJOR_CATEGORY_NAMES[majorCode] : '기타'

  // 종목명 조회
  const industryName = COMMON_INDUSTRY_NAMES[code] || '기타'

  // 중분류명 조회
  const industryMiddle = MIDDLE_CATEGORY_NAMES[middleCode] || ''

  return {
    source: 'ksic',
    industryCode: code,
    businessType,
    industryName,
    industryMajor: businessType,
    industryMiddle,
    industrySmall: '',
  }
}

/**
 * 업태(대분류) 추출
 */
export function getBusinessTypeFromCode(industryCode: string | null): string | null {
  if (!industryCode || industryCode.length < 2) {
    return null
  }

  const middleCode = industryCode.substring(0, 2)
  const majorCode = MAJOR_CATEGORY_MAP[middleCode]

  return majorCode ? MAJOR_CATEGORY_NAMES[majorCode] : null
}

/**
 * 종목(세세분류) 추출
 */
export function getIndustryNameFromCode(industryCode: string | null): string | null {
  if (!industryCode) {
    return null
  }

  return COMMON_INDUSTRY_NAMES[industryCode] || null
}

/**
 * 모든 대분류 목록 반환
 */
export function getAllBusinessTypes(): Array<{ code: string; name: string }> {
  return Object.entries(MAJOR_CATEGORY_NAMES).map(([code, name]) => ({
    code,
    name,
  }))
}
